<!DOCTYPE html>
<html>
	<head>
		<link href="http://gmpg.org/xfn/11" rel="profile">

		<meta charset="utf-8">
		<title>Extending Xcode with power-ups</title>
		<meta name="viewport" content="width=device-width">
		
		<link rel="stylesheet" href="https://trycombine.com/css/hybrid.css">
		<link rel="stylesheet" href="https://trycombine.com/css/style.css">
		<link rel="stylesheet" href="https://trycombine.com/css/colors-dark.css">
		
		<meta property="og:title" content="Extending Xcode with power-ups" />
<meta property="og:type" content="website" />
<meta property="og:description" content="Swift development related blog-posts. Combine, modern concurrency model, Instruments, and more." />
<meta property="og:type" content="website" />
<meta property="og:locale" content="en_US" />
<meta property="og:url" content="https://trycombine.com/posts/xcode-powerups/" />
<meta property="og:image" content="https://trycombine.com/images/trycombine.png" />
<meta property="og:site_name" content="try Combine" />

<meta name="description" content="Swift development related blog-posts. Combine, modern concurrency model, Instruments, and more.">
<meta name="author" content="Marin Todorov">

<link href rel="alternate" type="application/rss+xml" title="try Combine">

<meta name="twitter:card" content="summary">
<meta name="twitter:description" content="Swift development related blog-posts. Combine, modern concurrency model, Instruments, and more." />
<meta name="twitter:creator" content="@icanzilb" />

<meta name="twitter:title" content="Extending Xcode with power-ups">


<meta name="twitter:image:src" content="https://trycombine.com/images/trycombine.png">
<meta name="twitter:image:width" content="800">
<meta name="twitter:image:height" content="800">

<link rel="stylesheet" href="https://trycombine.com/css/bootstrap-table.css">

	</head>
	<body>
		<header id="header">
			<h1><a href="https://trycombine.com/">try Code</a></h1>
			<p>by Marin Todorov</p>
			<nav style="border-top: 1px solid #555; height: 36px; border-bottom: 1px solid #555;"> 
	<div id="menu">
		<ul id="combineslack" style="float: right;">
			<li><a href="http://slack.combine.community/"><span>Combine Slack &rsaquo;</span></a></li>
		</ul>
	
		<ul class="nav">
			
				<li><a href="http://www.underplot.com"><span>Contact</span></a></li>
			
		</ul>
	
		<ul class="nav">
			
				<li><a href="https://github.com/icanzilb"><span>Github</span></a></li>
			
		</ul>
	
		<ul class="nav">
			
				<li><a href="https://twitter.com/icanzilb"><span>Twitter</span></a></li>
			
		</ul>
	
	</div>
</nav>

		</header>

		<div id="page">
			<div id="sidebar">
				<div class="sidebar-posts">
    <div class="sidebar-title"><a href="https://trycombine.com/index.xml" class="rss-button"><img src="https://trycombine.com/images/ic_rss_feed_48px.png"></a> Latest posts:</div>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/swift-concurrency-task-group-workflow/">&raquo; &nbsp; 21/Feb &middot; TaskGroup as a workflow design tool</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/swift-concurrency-task-group/">&raquo; &nbsp; 16/Feb &middot; The issue with task groups or how I discovered a solved problem</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/swift-light-ide-update-jan/">&raquo; &nbsp; 31/Jan &middot; Swift Light IDE update, Jan 31st</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/swift-read-modify-coroutines/">&raquo; &nbsp; 25/Jan &middot; Yielding accessors in Swift</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/swift-async-sequence-extensions-2/">&raquo; &nbsp; 21/Jan &middot; Swift Async Sequence extensions (part 2)</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/swift-async-sequence-extensions-1/">&raquo; &nbsp; 19/Jan &middot; Swift Async Sequence extensions (part 1)</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/xcode-powerups/">&raquo; &nbsp; 20/Dec &middot; Extending Xcode with power-ups</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/announcing-modern-swift-concurrency-book/">&raquo; &nbsp; 3/Nov &middot; Announcing: “Modern Concurrency in Swift”</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/swift-actor-dispatch-queues-concurrency/">&raquo; &nbsp; 6/Oct &middot; Actors, the cooperative pool and concurrency</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/performance-actor-queue-lock-benchmark/">&raquo; &nbsp; 30/Sep &middot; Performance: Actor vs queue vs lock</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/thread-task-sleep/">&raquo; &nbsp; 13/Sep &middot; The difference between Thread.sleep() and Task.sleep()</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/combine-async-sequence-2/">&raquo; &nbsp; 13/Jul &middot; Bridge from Combine to AsyncSequence - the code (p. 2)</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/combine-async-sequence-1/">&raquo; &nbsp; 12/Jul &middot; Bridge from Combine to AsyncSequence - the plan (p. 1)</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/swift-actors-combine/">&raquo; &nbsp; 12/May &middot; Swift Actors: A practical example, part 2</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/swift-actors/">&raquo; &nbsp; 10/May &middot; Swift Actors: A practical example, part 1</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/self-weak-unowned/">&raquo; &nbsp; 3/Mar &middot; Using self, weak, and unowned in Combine</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/cancellor/">&raquo; &nbsp; 5/Feb &middot; Owning AnyCancellable with Cancellor</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/timelane-nsspain-2020/">&raquo; &nbsp; 20/Nov &middot; 5 Stranger Things you can do with Timelane at NSSpain</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/how-to-create-custom-instrument/">&raquo; &nbsp; 19/Apr &middot; How to create a custom instrument on top of Timelane!</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/timelane-combine-update/">&raquo; &nbsp; 13/Mar &middot; Timelane - the first two weeks!</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/announcing-timelane-combine/">&raquo; &nbsp; 28/Feb &middot; Announcing: Timelane</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/combine-property-wrappers/">&raquo; &nbsp; 11/Sep &middot; Property Wrappers with Combine</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/subscribe-on-receive-on/">&raquo; &nbsp; 9/Sep &middot; subscribe(on:) vs receive(on:)</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/combinedatasources-multiple-sections/">&raquo; &nbsp; 7/Sep &middot; Binding a list with multiple sections and different cells</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/combinedatasources-simple-static-list/">&raquo; &nbsp; 3/Sep &middot; Binding a simple list to a UITableView</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/assert-max-subscriptions/">&raquo; &nbsp; 29/Aug &middot; An assert operator: assertMaxSubscriptions()</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/debug-logging-combineprintout/">&raquo; &nbsp; 16/Aug &middot; Debug logging with CombinePrintout</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/more-simple-custom-combine-operators-with-sample/">&raquo; &nbsp; 6/Aug &middot; Building a custom `sample` operator</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/simple-custom-combine-operators/">&raquo; &nbsp; 2/Aug &middot; Simple custom Combine operators</a>
      </li>
    
  </div>

<style>
	  .sidebar-post { font-size:0.75em; margin-top:12px; line-height: 14px;}
    .sidebar-post a { text-decoration: none; }
    .sidebar-post a:hover { text-decoration: underline; }
</style>

			</div>

			<div id="content">
				
	<article class="post">
				<div id="promo">
				
			<div id="combinebook" style="font-size: 0.8em; text-align:center; font-family: sans-serif; font-weight: bold;">
				<style>
					#combinebook a:hover { background: transparent!important; }
				</style>
				  <a href="http://swiftconcurrencybook.com" target="_blank" style="text-decoration:none;">
					<img src="https://trycombine.com/images/concurrency-book.png" style="width:140px; box-shadow: 2px 3px #354465;border-radius:5px;"/>
				  </a>
				  <a href="http://swiftconcurrencybook.com">Modern Concurrency<br/> in Swift</a> <span class="new-badge">New</span>
			</div>
        </div>

			
		<h1>Extending Xcode with power-ups </h1>

<style>
  .twitter-share-button {
  	font-family: 'Helvetica Neue',Arial,sans-serif;
  	background: #4793DA;
  	color: white;
  	padding-left: 16px;
  	padding-right: 16px;
  	margin-top: 2px;
  	border-radius: 4px;
  	font-size: 0.85em;
  	line-height: 3em;
  }

  .twitter-share-button:hover {
  	background: #3C769F;
  	color: white;
  	padding-left: 16px;
  	padding-right: 16px;
  	margin-top: 2px;
  }

  .twitter-share-button:active {
  	background: #284F6A;
  	color: white;
  	padding-left: 16px;
  	padding-right: 16px;
  	margin-top: 2px;
  }

</style>

<p><a class="twitter-share-button"
  href="https://twitter.com/intent/tweet?text=Extending%20Xcode%20with%20power-ups&url=https%3a%2f%2ftrycombine.com%2fposts%2fxcode-powerups%2f"
  data-size="medium">
Tweet</a><p>

		<div class="post-content"><p>In this post I describe the technical setup of a small language experiment I developed to aid myself working on custom Xcode instruments.</p>
<h2 id="the-need-for-a-more-flexible-coding-inside-xcode">The need for a more flexible coding inside Xcode</h2>
<p>Last month, I prototyped a

<a href="https://twitter.com/icanzilb/status/1460275096552148998" target="_blank">Swift IDE</a>
 and became very interested in enhancing the experience of building with Swift. (Since Apple doesn&rsquo;t hire remotely, I wonder what other companies are working in that area?)</p>
<p>A little later, I came back to updating my custom Xcode Instrument called Timelane to support debugging new code based on the new Swift modern concurrency APIs:</p>

<img src="https://trycombine.com/images/timelane/powerups-timeline.jpeg" width=600/>

<p>Unlike previous Timelane versions that supported Combine and RxSwift which are based on very minimal protocols, the new instrument needed to support a ton of different APIs like <code>TaskGroup()</code>, <code>TaskGroup.addTask()</code> <code>Task()</code>, <code>Task.detached()</code>, and more.</p>
<p>Simple custom Xcode instruments are defined in a single XML file, and once I hit the 1,000 line mark developing came to a grinding halt. I tried some creative approaches like including ASCII art in Xcode&rsquo;s jump menu:</p>

<img src="https://trycombine.com/images/timelane/powerups-snoopy.jpeg" width=600/>

<p>But ultimately thousands of lines of flat XML simply aren&rsquo;t manageable during active development. So, I took a deep breath and made a detour to create a simple language extension that plugs right into Xcode&hellip;</p>
<h2 id="pre-actions-and-post-actions-in-xcode">Pre-actions and post-actions in Xcode</h2>
<p>I do have some minimal experince with React and Vue.js and I&rsquo;m a fan of the idea of transpiling: designing cool/powerful APIs that &ldquo;unwrap&rdquo; into less elegant/usable code in the target language! It&rsquo;s a win-win.</p>
<p>So, I looked into possible ways to integrate something quick with Xcode. You can add scripts to automatically run on events like build, run, test, etc. and I found that I needed exactly two things that Xcode offers out of the box:</p>
<ol>
<li>A &ldquo;build pre-action&rdquo; — to parse &amp; transpile my custom code into the target Xcode XML format.</li>
<li>A &ldquo;run post-action&rdquo; — to clean any generated, transpiled code from the source.</li>
</ol>

<img src="https://trycombine.com/images/timelane/powerups-workflow.png" width=650/>

<p>This way, while editing code, I can work with a clean, minimal version of the code using my own syntax.</p>
<p>Once a batch of changes are completed, I build and that generates the output XML  putting Xcode to work on validating it and displaying errors and warnings.</p>
<p>Once the errors are solved, I can run the project to test the custom instrument in Instruments while consulting the full, generated code. When I quit the custom instrument I can work again with the minimal, custom code.</p>
<p>It&rsquo;s a clean, straigh-forward process that helped me easily work on the instrument that is currently over 2,000 lines of XML when &ldquo;unwrapped&rdquo;.</p>
<h2 id="xml-includes">XML Includes</h2>
<p>First of all, I wanted to break the monolith by extracting various pieces into a clean hierarchy of folders and files. I added an include command that includes an XML file during build and then removes the included code during cleanup:</p>

<img src="https://trycombine.com/images/timelane/powerups-include.png" width=600/>

<p>Breaking the 1,000s of lines of flat XML into scoped, smaller files of up to a couple of hundred lines made the codebase easy to navigate.</p>
<p>I chose to use commands wrapped in XML comments to make my custom code valid XML — this way the custom syntax doesn&rsquo;t trigger errors in Xcode&rsquo;s code editor.</p>
<p>The build phase finds tags looking like this:</p>
<div class="highlight"><div style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#999;font-style:italic">&lt;!-- include &#34;tasks-instrument.xml&#34; --&gt;</span></code></pre></td></tr></table>
</div>
</div>
<p>And inserts the target file&rsquo;s contents after the original tag&rsquo;s location like so:</p>
<div class="highlight"><div style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#999;font-style:italic">&lt;!-- include &#34;tasks-instrument.xml&#34; --&gt;</span>

	<span style="color:#999;font-style:italic">&lt;!-- included &#34;tasks-instrument.xml&#34; &#34;982F43E4-59E0-45A4-A199-18C3DED2730E&#34; --&gt;</span>

	  <span style="color:#999;font-style:italic">&lt;!-- MARK: - TASKS INSTRUMENT --&gt;</span>
	  <span style="color:#999;font-style:italic">&lt;!--
</span><span style="color:#999;font-style:italic">	  	The tasks instrument.
</span><span style="color:#999;font-style:italic">	  --&gt;</span>
	  
	  <span style="color:#6ab825;font-weight:bold">&lt;augmentation&gt;</span>
	  	<span style="color:#6ab825;font-weight:bold">&lt;id&gt;</span>${instrumentID}.byname<span style="color:#6ab825;font-weight:bold">&lt;/id&gt;</span>
	  	<span style="color:#6ab825;font-weight:bold">&lt;title&gt;</span>Show Tasks by Name<span style="color:#6ab825;font-weight:bold">&lt;/title&gt;</span>
	  	<span style="color:#6ab825;font-weight:bold">&lt;purpose&gt;</span>A view that provides insight into individual tasks on the timeline.<span style="color:#6ab825;font-weight:bold">&lt;/purpose&gt;</span>

    ...

	<span style="color:#999;font-style:italic">&lt;!-- / included &#34;tasks-instrument.xml&#34; &#34;982F43E4-59E0-45A4-A199-18C3DED2730E&#34; --&gt;</span>
	  </code></pre></td></tr></table>
</div>
</div>
<p>Once I&rsquo;m finished debugging the instrument, the cleanup phase removes the code between the opening and closing &ldquo;included&rdquo; tags. (I&rsquo;m not saying this process is bullet-proof but I have to say it works solidly for my use case.)</p>
<p>When the includes worked to my needs I could design a few levels deep structure that made each component in the package easy to work with and reason about. Below is part of the actual hierarchy:</p>
<pre tabindex="0"><code>Instrument package

  +- tasks-schema.xml
    +- schema-metadata.xml
    +- region-tracking-partial.xml
    +- [Custom XML]
    -- region-tracking-open-interval-partial.xml

  +- region-tracking-open-interval-partial.xml
    ...  
    
  +- task-groups-schema.xml
    +- schema-metadata.xml
    +- region-tracking-partial.xml
    -- region-tracking-open-interval-partial.xml

  ...
</code></pre><p>You might&rsquo;ve already noticed it, but take another look above — both schemas include a) &ldquo;<em>schema-metadata.xml</em>&rdquo;, b) &ldquo;<em>region-tracking-partial.xml</em>&rdquo; and c) &ldquo;<em>region-tracking-open-interval-partial.xml</em>&rdquo;. Some of these includes are reused verbatim and this decreases the total amount of code to take care of drastically.</p>
<p>Other includes weren&rsquo;t exactly the same but the variation was minimal so (again, inspired by Vue.js) I thought I&rsquo;d add data binding to the components (in my case the components are the includes).</p>
<h2 id="data-bindings">Data bindings</h2>
<p>Since the includes work hierarchically, it made sense to also have hierarchical data bindings, e.g. much like the environment in SwiftUI children inherit the definitions of their parents and merge-in their own.</p>
<p>First, I added a JSON file that contains any global constants that aren&rsquo;t bound to a specific component:</p>

<img src="https://trycombine.com/images/timelane/powerups-globals.png" width=500/>

<p>And extended the powerups to support <code>${...}</code> syntax in the templates like so:</p>
<div class="highlight"><div style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#6ab825;font-weight:bold">&lt;subsystem&gt;</span>&#34;${instrumentID}.time&#34;<span style="color:#6ab825;font-weight:bold">&lt;/subsystem&gt;</span>
<span style="color:#6ab825;font-weight:bold">&lt;category&gt;</span>&#34;DynamicStackTracing&#34;<span style="color:#6ab825;font-weight:bold">&lt;/category&gt;</span></code></pre></td></tr></table>
</div>
</div>
<p>This took care of easily fine-tuning data like the instrument identifeir, identifiers of the subsystems and various tables ids, as well as the instrument version, and more.</p>
<p>More interestingly, I added syntax to the include tags to bind data — that really made them feel like proper components. For example:</p>
<div class="highlight"><div style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#6ab825;font-weight:bold">&lt;os-signpost-point-schema&gt;</span>
	<span style="color:#999;font-style:italic">&lt;!-- include &#34;schema-metadata.xml&#34; id=&#34;async-taskgroupresults-schema&#34; schemaTitle=&#34;Task Group Results&#34; entity=&#34;taskgroups&#34; --&gt;</span>
	<span style="color:#999;font-style:italic">&lt;!-- include &#34;value-tracking-partial.xml&#34; entity=&#34;TaskGroup&#34; --&gt;</span>
<span style="color:#6ab825;font-weight:bold">&lt;/os-signpost-point-schema&gt;</span></code></pre></td></tr></table>
</div>
</div>
<p>All params that aren&rsquo;t recognized tag properties are bound as data to the template and its children.</p>
<p>This enabled dynamically building identifiers, names and even comments in the generated code:</p>
<div class="highlight"><div style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#999;font-style:italic">&lt;!-- The data table storing ${entity} data --&gt;</span>
<span style="color:#6ab825;font-weight:bold">&lt;create-table&gt;</span>
	<span style="color:#6ab825;font-weight:bold">&lt;id&gt;</span>${entity}-table<span style="color:#6ab825;font-weight:bold">&lt;/id&gt;</span>
	<span style="color:#6ab825;font-weight:bold">&lt;schema-ref&gt;</span>async-${entity}-schema<span style="color:#6ab825;font-weight:bold">&lt;/schema-ref&gt;</span>
<span style="color:#6ab825;font-weight:bold">&lt;/create-table&gt;</span></code></pre></td></tr></table>
</div>
</div>
<p>This made the complete package code very DRY pushing the 2,000+ lines of XML to less than 1,000 split across 20-ish files.</p>
<h2 id="conditionals">Conditionals</h2>
<p>Before wrapping up, I noticed that I can reuse even more code but some instruments needed it and some didn&rsquo;t. I had to add conditionals (and by god at this point I considered just switching to XSL but I was having too much fun with this.)</p>
<p>To implement conditional includes I added a <code>where</code> tag property like this:</p>
<div class="highlight"><div style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#999;font-style:italic">&lt;!-- include &#34;tasks-augmentation.xml&#34; where &#34;${entity}==tasks&#34; --&gt;</span></code></pre></td></tr></table>
</div>
</div>
<p>This would include the template and bind the data, etc. only if the <code>where</code> condition evaluates to true.</p>
<p>The whole powerups experiment took just some hours to complete but it unblocked me to move forward and complete the instrument itself, which otherwise would probably have been impossible.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Creating custom instruments is such a niche job that my powerups experiment as-is isn&rsquo;t useful beside my concrete use-case (in all fairness, the XML API should&rsquo;ve been a Swift DSL in first place if developers were supposed to really use it):</p>

<img src="https://trycombine.com/images/timelane/powerups-demo.gif" width=650/>

<p>Regardless, I hope that this write-up has been inspiring — your day-to-day workflow in Xcode could be extended in a bunch of ways and writing your own language extensions or a full-blown transpiler is possible even if not very easy to do.</p>
<p>To be honest, I wish I&rsquo;d looked into building more language extensions in the past instead of spending tons of time on mundain code tasks.</p>
<p>Till next time!</p>
<h2 id="where-to-go-from-here">Where to go from here?</h2>
<p>If you&rsquo;d like to support me, get my book on Swift Concurrency:</p>
<p>» <a href="https://swiftconcurrencybook.com">swiftconcurrencybook.com</a> «</p>
<p>Interested in discussing the new <code>async</code>/<code>await</code> Swift syntax and concurrency? Hit me up on twitter at <a href="https://twitter.com/icanzilb">https://twitter.com/icanzilb</a>.</p>
</div>
    <hr/>
    <div><i>If you like these free blog posts, check out some of the books I worked on!</i></div>

    <div id="combinebook">
      <table width="100%">
        <tr>
<td style="font-size: 0.9em; font-family: sans-serif; font-weight: bold; text-align:center;">
  <a href="http://swiftconcurrencybook.com" target="_blank" style="text-decoration:none;">
    <img src="https://trycombine.com/images/concurrency-book.png" style="width:150px; box-shadow: 4px 6px #354465;border-radius:5px;">
  </a>
  <br/>
  <a href="http://swiftconcurrencybook.com">Modern Concurrency in Swift</a><span class="new-badge">New</span>
</td>

<td style="font-size: 0.9em; font-family: sans-serif; font-weight: bold; text-align:center;">
  <a href="http://combinebook.com" target="_blank" style="text-decoration:none;">
    <img src="https://trycombine.com/images/combine.png" style="width:150px; box-shadow: 4px 6px #354465;border-radius:10px;">
  </a>
  <br/>
  <a href="https://combinebook.com">Combine: Asynchronous<br/> programming with Swift</a>
</td>
        </tr>
      </table>
				<br/>
		</div>
		<p class="meta">Posted on <span class="postdate">20. December 2021</span></p>
	</article>
	

			</div>

			<footer id="footer">
				<p class="copyright">
					
						Powered by <a href="https://gohugo.io/">Hugo</a> and the
						<a href="https://github.com/bake/solar-theme-hugo">Solar</a>-theme.
					
				</p>
			</footer>
		</div>

		<script>window.twttr = (function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0],
    t = window.twttr || {};
  if (d.getElementById(id)) return t;
  js = d.createElement(s);
  js.id = id;
  js.src = "https://platform.twitter.com/widgets.js";
  fjs.parentNode.insertBefore(js, fjs);

  t._e = [];
  t.ready = function(f) {
    t._e.push(f);
  };

  return t;
}(document, "script", "twitter-wjs"));</script>

<script src="https://unpkg.com/@telemetrydeck/sdk/dist/telemetrydeck.min.js" defer></script>

<script>
  if (window.location.href.indexOf("localhost") < 0) {
    window.td = window.td || [];
    td.push(['app', '6DB9CD84-C400-4746-9E87-56EAD0D97492'], ['user', 'anonymous'], ['signal']);
  } else {
      console.log('localhost');
  }
</script>
	</body>
</html>
