<!DOCTYPE html>
<html>
	<head>
		<link href="http://gmpg.org/xfn/11" rel="profile">

		<meta charset="utf-8">
		<title>Property Wrappers with Combine</title>
		<meta name="viewport" content="width=device-width">
		
		<link rel="stylesheet" href="https://trycombine.com/css/hybrid.css">
		<link rel="stylesheet" href="https://trycombine.com/css/style.css">
		<link rel="stylesheet" href="https://trycombine.com/css/colors-dark.css">
		<meta property="og:title" content="Property Wrappers with Combine" />
<meta property="og:type" content="website" />
<meta property="og:description" content="How to laverage the Swift 5.1 property wrappers to make the most of your Combine code" />
<meta property="og:type" content="website" />
<meta property="og:locale" content="en_US" />
<meta property="og:url" content="https://trycombine.com/posts/combine-property-wrappers/" />
<meta property="og:image" content="https://trycombine.com/images/trycombine.png" />
<meta property="og:site_name" content="try Combine" />

<meta name="description" content="How to laverage the Swift 5.1 property wrappers to make the most of your Combine code">
<meta name="author" content="Marin Todorov">

<link href rel="alternate" type="application/rss+xml" title="try Combine">

<meta name="twitter:card" content="summary">
<meta name="twitter:description" content="How to laverage the Swift 5.1 property wrappers to make the most of your Combine code" />
<meta name="twitter:creator" content="@icanzilb" />

<meta name="twitter:title" content="Property Wrappers with Combine">


<meta name="twitter:image:src" content="https://trycombine.com/images/trycombine.png">
<meta name="twitter:image:width" content="800">
<meta name="twitter:image:height" content="800">

<link rel="stylesheet" href="https://trycombine.com/css/bootstrap-table.css">

	</head>
	<body>
		<header id="header">
			<h1><a href="https://trycombine.com/">try Code</a></h1>
			<p>by Marin Todorov</p>
			<nav style="border-top: 1px solid #555; height: 36px; border-bottom: 1px solid #555;"> 
	<div id="menu">
		<ul id="combineslack" style="float: right;">
			<li><a href="http://slack.combine.community/"><span>Combine Slack &rsaquo;</span></a></li>
		</ul>
	
		<ul class="nav">
			
				<li><a href="http://www.underplot.com"><span>Contact</span></a></li>
			
		</ul>
	
		<ul class="nav">
			
				<li><a href="https://github.com/icanzilb"><span>Github</span></a></li>
			
		</ul>
	
		<ul class="nav">
			
				<li><a href="https://twitter.com/icanzilb"><span>Twitter</span></a></li>
			
		</ul>
	
	</div>
</nav>

		</header>

		<div id="page">
			<div id="sidebar">
				<div class="sidebar-posts">
    <div class="sidebar-title"><a href="https://trycombine.com/index.xml" class="rss-button"><img src="https://trycombine.com/images/ic_rss_feed_48px.png"></a> Latest posts:</div>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/custom-view-modifier-to-handle-features-that-are-only-enabled-in-the-pro-version-of-the-app/">&raquo; &nbsp; 5/Dec &middot; Custom SwiftUI view modifier for paid app features</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/datatile-for-simulator-public-beta-on-testflight-now/">&raquo; &nbsp; 29/Nov &middot; dataTile for Simulator - public beta on TestFlight now!</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/12-of-my-favorite-side-projects-in-2022/">&raquo; &nbsp; 7/Nov &middot; My favorite 12 side projects in 2022</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/introducing-got-jobs/">&raquo; &nbsp; 6/Nov &middot; Introducing: Got Jobs?</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/introducing-markcodable/">&raquo; &nbsp; 6/Sep &middot; Introducing MarkCodable</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/introducing-timeui/">&raquo; &nbsp; 20/Mar &middot; Introducing timeui</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/swift-performance-concurrency-4/">&raquo; &nbsp; 14/Mar &middot; Optimization in Swift, part 4</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/swift-performance-concurrency-3/">&raquo; &nbsp; 10/Mar &middot; Optimization in Swift, part 3</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/swift-performance-concurrency-2/">&raquo; &nbsp; 9/Mar &middot; Optimization in Swift, part 2</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/swift-performance-concurrency-1/">&raquo; &nbsp; 3/Mar &middot; Optimization in Swift, part 1</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/swift-concurrency-task-group-workflow/">&raquo; &nbsp; 21/Feb &middot; TaskGroup as a workflow design tool</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/swift-concurrency-task-group/">&raquo; &nbsp; 16/Feb &middot; The issue with task groups or how I discovered a solved problem</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/swift-light-ide-update-jan/">&raquo; &nbsp; 31/Jan &middot; Swift Light IDE update, Jan 31st</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/swift-read-modify-coroutines/">&raquo; &nbsp; 25/Jan &middot; Yielding accessors in Swift</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/swift-async-sequence-extensions-2/">&raquo; &nbsp; 21/Jan &middot; Swift Async Sequence extensions (part 2)</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/swift-async-sequence-extensions-1/">&raquo; &nbsp; 19/Jan &middot; Swift Async Sequence extensions (part 1)</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/xcode-powerups/">&raquo; &nbsp; 20/Dec &middot; Extending Xcode with power-ups</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/announcing-modern-swift-concurrency-book/">&raquo; &nbsp; 3/Nov &middot; Announcing: “Modern Concurrency in Swift”</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/swift-actor-dispatch-queues-concurrency/">&raquo; &nbsp; 6/Oct &middot; Actors, the cooperative pool and concurrency</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/performance-actor-queue-lock-benchmark/">&raquo; &nbsp; 30/Sep &middot; Performance: Actor vs queue vs lock</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/thread-task-sleep/">&raquo; &nbsp; 13/Sep &middot; The difference between Thread.sleep() and Task.sleep()</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/combine-async-sequence-2/">&raquo; &nbsp; 13/Jul &middot; Bridge from Combine to AsyncSequence - the code (p. 2)</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/combine-async-sequence-1/">&raquo; &nbsp; 12/Jul &middot; Bridge from Combine to AsyncSequence - the plan (p. 1)</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/swift-actors-combine/">&raquo; &nbsp; 12/May &middot; Swift Actors: A practical example, part 2</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/swift-actors/">&raquo; &nbsp; 10/May &middot; Swift Actors: A practical example, part 1</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/self-weak-unowned/">&raquo; &nbsp; 3/Mar &middot; Using self, weak, and unowned in Combine</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/cancellor/">&raquo; &nbsp; 5/Feb &middot; Owning AnyCancellable with Cancellor</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/timelane-nsspain-2020/">&raquo; &nbsp; 20/Nov &middot; 5 Stranger Things you can do with Timelane at NSSpain</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/how-to-create-custom-instrument/">&raquo; &nbsp; 19/Apr &middot; How to create a custom instrument on top of Timelane!</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/timelane-combine-update/">&raquo; &nbsp; 13/Mar &middot; Timelane - the first two weeks!</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/announcing-timelane-combine/">&raquo; &nbsp; 28/Feb &middot; Announcing: Timelane</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/combine-property-wrappers/">&raquo; &nbsp; 11/Sep &middot; Property Wrappers with Combine</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/subscribe-on-receive-on/">&raquo; &nbsp; 9/Sep &middot; subscribe(on:) vs receive(on:)</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/combinedatasources-multiple-sections/">&raquo; &nbsp; 7/Sep &middot; Binding a list with multiple sections and different cells</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/combinedatasources-simple-static-list/">&raquo; &nbsp; 3/Sep &middot; Binding a simple list to a UITableView</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/assert-max-subscriptions/">&raquo; &nbsp; 29/Aug &middot; An assert operator: assertMaxSubscriptions()</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/debug-logging-combineprintout/">&raquo; &nbsp; 16/Aug &middot; Debug logging with CombinePrintout</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/more-simple-custom-combine-operators-with-sample/">&raquo; &nbsp; 6/Aug &middot; Building a custom `sample` operator</a>
      </li>
    
      <li class="sidebar-post" style="margin-top: 12px;">
          <a href="https://trycombine.com/posts/simple-custom-combine-operators/">&raquo; &nbsp; 2/Aug &middot; Simple custom Combine operators</a>
      </li>
    
  </div>

<style>
	  .sidebar-post { font-size:0.75em; margin-top:12px; line-height: 14px;}
    .sidebar-post a { text-decoration: none; }
    .sidebar-post a:hover { text-decoration: underline; }
</style>

			</div>

			<div id="content">
				
	<article class="post">
		
			
		<h1 style="margin-bottom: 10px; padding-bottom: 5px; border-bottom: 0px solid orange;">Property Wrappers with Combine </h1>

<style>
  .twitter-share-button {
  	font-family: 'Helvetica Neue',Arial,sans-serif;
  	background: #4793DA;
  	color: white;
  	padding-left: 16px;
  	padding-right: 16px;
  	margin-top: 2px;
  	border-radius: 4px;
  	font-size: 0.85em;
  	line-height: 3em;
  }

  .twitter-share-button:hover {
  	background: #3C769F;
  	color: white;
  	padding-left: 16px;
  	padding-right: 16px;
  	margin-top: 2px;
  }

  .twitter-share-button:active {
  	background: #284F6A;
  	color: white;
  	padding-left: 16px;
  	padding-right: 16px;
  	margin-top: 2px;
  }

</style>



    <div style="border: 2px solid purple; border-radius: 10px; padding: 5px; margin-bottom:10px;margin-top:20px;">
	  <div style="position:absolute;left:15px;background:purple;font-size:0.75em;font-family:sans-serif;padding-left:5px; padding-right:5px;margin-top:-13px;line-height:1.1em;border-radius:6px;">promotion</div>
	  <table>
		<tr>
		  <td style="padding-top:10px;"><a href="https://underplot.com/dataTile" style="margin:0px;padding:0px;"><img src="https://underplot.com/dataTile/images/tile/hero-window.gif" src1="../../images/tile/Icon_128x128.png" width=164 style="margin-right: 20px;margin-left: 10px;mask-image:url(https://underplot.com/dataTile/images/tile/mask-568.png);mask-size:contain;"/></a></td>
		  <td style="vertical-align:top;font-family:sans-serif;font-weight: normal; font-size: 0.85em;line-height: 1.4em;padding-top:22px;">
			<a href="https://underplot.com/dataTile" style="margin:0px;padding:0px;background-color: #073642;border-color: #98e4df;color: #98e4df;">
			Forget debugging in the console!<br/>
			Super-charge your debugging flow in Xcode with<br/> no code changes or 3rd party frameworks.
			</a>
		  </td>
		</tr>
	  </table>
	</div>
	

		<div class="post-content"><p>In this post I&rsquo;ll look into making more out of Combine code by using the newly introduced in Swift 5.1: <strong>Property Wrappers</strong>.</p>
<p>Let&rsquo;s very quickly go into what property wrappers are in general and then dive into a Combine example.</p>
<h2 id="swift-property-wrappers">Swift Property Wrappers</h2>
<p>Property wrappers are a new feature in Swift 5.1 that allows you to abstract redundant functionality around handling type properties.</p>
<p>Property wrappers are very handy in (my experience so far 🤓 ) two ways:</p>
<ul>
<li>You can control the value of a property via your potentially complex logic absolutely opaquely to the consumer, and</li>
<li>You can have a &ldquo;projected value&rdquo; which is an automatically added to your type property, which you can create/update in relation to the original property you &ldquo;wrap&rdquo;.</li>
</ul>
<p>Let&rsquo;s have a look at the first of these below and in the next section we&rsquo;ll cover number two. 😬</p>
<p>You&rsquo;re building a view model and you&rsquo;d like to have a property called <code>progress</code> like so:</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">struct</span> <span style="color:#447fcf;text-decoration:underline">ViewModel</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#6ab825;font-weight:bold">var</span> <span style="color:#40ffff">progress</span>: <span style="color:#24909d">Int</span> = <span style="color:#3677a9">0</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>Since the value is a completion precentage no values outside the <code>[0, 100]</code> range would make sense. You can &ldquo;wrap&rdquo; the <code>progress</code> property with a custom wrapper to limit the property&rsquo;s potential values.</p>
<p>Here&rsquo;s how to write that custom wrapper code:</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span>@propertyWrapper
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">public</span> <span style="color:#6ab825;font-weight:bold">struct</span> <span style="color:#447fcf;text-decoration:underline">Percentage</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#6ab825;font-weight:bold">var</span> <span style="color:#40ffff">value</span>: <span style="color:#24909d">Int</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#6ab825;font-weight:bold">public</span> <span style="color:#6ab825;font-weight:bold">var</span> <span style="color:#40ffff">wrappedValue</span>: <span style="color:#24909d">Int</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#6ab825;font-weight:bold">get</span> { value }
</span></span><span style="display:flex;"><span>    <span style="color:#6ab825;font-weight:bold">set</span> { value = max(<span style="color:#3677a9">0</span>, min(<span style="color:#3677a9">100</span>, newValue)) }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#6ab825;font-weight:bold">public</span> <span style="color:#6ab825;font-weight:bold">init</span>(wrappedValue: <span style="color:#24909d">Int</span>) {
</span></span><span style="display:flex;"><span>    value = wrappedValue
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>I declare a struct called <code>Percentage</code> which features the attribute <code>@propertyWrapper</code> that makes <code>@Percentage</code> part of the Swift syntax (thanks to syntactic sugar). The type&rsquo;s members are as follows:</p>
<ul>
<li><code>value</code> is the wrapper data storage,</li>
<li><code>wrappedValue</code> is the proxy to the original property (e.g. this is what you&rsquo;re accessing when you get/set the property being wrapped),</li>
<li><code>init(wrappedValue:)</code> is the wrapper initializer that takes the initial property value as declared in code.</li>
</ul>
<p>Now I can prepend <code>@Percentage</code> to any property and make it a perecentage value limited to the range <code>[0, 100]</code>.</p>
<p>Let&rsquo;s see an example that will demonstrate the above. Let&rsquo;s revise the <code>ViewModel</code> type from earlier and wrap its <code>progress</code> property:</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">struct</span> <span style="color:#447fcf;text-decoration:underline">ViewModel</span> {
</span></span><span style="display:flex;"><span>  @Percentage <span style="color:#6ab825;font-weight:bold">var</span> <span style="color:#40ffff">progress</span>: <span style="color:#24909d">Int</span> = <span style="color:#3677a9">0</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>Now a new instance of <code>Percentage</code> will automatically manage the <code>progress</code> property by proxying it through its <code>wrappedValue</code> like so:</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span>model.progress = <span style="color:#3677a9">34</span>
</span></span><span style="display:flex;"><span>print(model.progress)
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic">// prints &#34;34&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>model.progress = -<span style="color:#3677a9">10</span>
</span></span><span style="display:flex;"><span>print(model.progress)
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic">// prints &#34;0&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>model.progress = <span style="color:#3677a9">100000</span>
</span></span><span style="display:flex;"><span>print(model.progress)
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic">// prints &#34;100&#34;</span></span></span></code></pre></div>
<p>Property wrappers let you abstract redundant code and make Swift&rsquo;s syntax more semantic. However, they also somewhat obscure code that is being trigger automatically. So, as with any powerful tool  - moderation is key :)</p>
<p>But let&rsquo;s see how in practice we can leverage the power of property wrappers with some Combine code.</p>
<h2 id="property-wrappers-and-combine">Property Wrappers and Combine</h2>
<p>In <a href="https://trycombine.com/posts/simple-custom-combine-operators/">Simple custom Combine operators</a> and <a href="https://trycombine.com/posts/more-simple-custom-combine-operators-with-sample/">Building a custom <code>sample</code> operator</a> we looked into creating very simple custom operators by abstracting redundant code.</p>
<p>These simple operators allow you to save yourself some typing when you consume some API and need to repeatedly process the stream in the same way. In other words if you always need to map, filter, and then remove duplicates from a stream you are free to group those operators under a &ldquo;new&rdquo; operator whenever that makes sense.</p>
<p>But how about if you are providing the API and your consumers need to always do the same operations on your output stream?</p>
<p>Let&rsquo;s look at our view model but this time Combine-ified:</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">class</span> <span style="color:#447fcf;text-decoration:underline">CourseViewModel</span> {
</span></span><span style="display:flex;"><span>  @Published <span style="color:#6ab825;font-weight:bold">var</span> <span style="color:#40ffff">name</span>: <span style="color:#24909d">String</span>
</span></span><span style="display:flex;"><span>  @Published <span style="color:#6ab825;font-weight:bold">var</span> <span style="color:#40ffff">surname</span>: <span style="color:#24909d">String</span>
</span></span><span style="display:flex;"><span>  @Published <span style="color:#6ab825;font-weight:bold">var</span> <span style="color:#40ffff">progress</span>: <span style="color:#24909d">Int</span>
</span></span><span style="display:flex;"><span>  ...
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>The users of your view model would most likely bind the three published properties to some UI controls - labels or other views. This will force them to write code like this to ensure they always update the UI on the main queue 😕:</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span>viewModel.<span style="color:#a61717;background-color:#e3d2d2">$</span>name
</span></span><span style="display:flex;"><span>  .receive(on: DispatchQueue.main)
</span></span><span style="display:flex;"><span>  .assign(to: <span style="color:#a61717;background-color:#e3d2d2">\</span>.text, on: nameLabel)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>viewModel.<span style="color:#a61717;background-color:#e3d2d2">$</span>surname
</span></span><span style="display:flex;"><span>  .receive(on: DispatchQueue.main)
</span></span><span style="display:flex;"><span>  .assign(to: <span style="color:#a61717;background-color:#e3d2d2">\</span>.text, on: surnameLabel)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>viewModel.<span style="color:#a61717;background-color:#e3d2d2">$</span>progress
</span></span><span style="display:flex;"><span>  .map { <span style="color:#ed9d13">&#34;Course progress: </span><span style="color:#ed9d13">\(</span><span style="color:#40ffff">$0</span><span style="color:#ed9d13">)</span><span style="color:#ed9d13">%&#34;</span> }
</span></span><span style="display:flex;"><span>  .receive(on: DispatchQueue.main)
</span></span><span style="display:flex;"><span>  .assign(to: <span style="color:#a61717;background-color:#e3d2d2">\</span>.text, on: progressLabel)</span></span></code></pre></div>
<p>To avoid this kind of repetition (always having to switch explicitly to the main thread) we can abstract that via a new property wrapper.</p>
<p>So, let&rsquo;s do it! 🚀</p>
<p>First we&rsquo;ll add almost exactly the same code as for the <code>@Percentage</code> wrapper and call the new type <code>PublishedOnMain</code> (as opposite to just <code>@Published</code>):</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span>@propertyWrapper
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">public</span> <span style="color:#6ab825;font-weight:bold">class</span> <span style="color:#447fcf;text-decoration:underline">PublishedOnMain</span>&lt;Value&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#6ab825;font-weight:bold">var</span> <span style="color:#40ffff">value</span>: Value
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#6ab825;font-weight:bold">public</span> <span style="color:#6ab825;font-weight:bold">var</span> <span style="color:#40ffff">wrappedValue</span>: Value {
</span></span><span style="display:flex;"><span>    <span style="color:#6ab825;font-weight:bold">get</span> { value }
</span></span><span style="display:flex;"><span>    <span style="color:#6ab825;font-weight:bold">set</span> { value = newValue }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#6ab825;font-weight:bold">public</span> <span style="color:#6ab825;font-weight:bold">init</span>(wrappedValue initialValue: Value) {
</span></span><span style="display:flex;"><span>    value = initialValue
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>As you see this time there is no custom logic of any sort for wrapping the original property. <code>PublishedOnMain</code> is generic over its storage value <code>Value</code> so it&rsquo;s just a property wrapper that can be added to any type of property.</p>
<p>First of all let&rsquo;s add a publisher to the storage property, like so:</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span>@Published <span style="color:#6ab825;font-weight:bold">var</span> <span style="color:#40ffff">value</span>: Value</span></span></code></pre></div>
<p>This adds a <code>$value</code> to <code>PublishedOnMain</code> which is a publisher emitting each time <code>value</code> is updated.</p>
<blockquote>
<p>Note:If you want to learn more about <code>@Published</code> and other ways to create Combine publishers definitely check out <a href="http://combinebook.com">Combine: Asynchronous programming with Swift</a>.</p>
</blockquote>
<p>In this example we&rsquo;ll use another property a wrapper might include called a <code>projectedValue</code>. Let&rsquo;s have a look - I&rsquo;ll add <code>projectedValue</code> to the wrapper type:</p>
<p>Now I&rsquo;ll add the projected value which will subscribe <code>$value</code> and make sure it receives on the main queue:</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">public</span> <span style="color:#6ab825;font-weight:bold">var</span> <span style="color:#40ffff">projectedValue</span>: AnyPublisher&lt;Value, Never&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#6ab825;font-weight:bold">return</span> <span style="color:#a61717;background-color:#e3d2d2">$</span>value
</span></span><span style="display:flex;"><span>    .receive(on: DispatchQueue.main)
</span></span><span style="display:flex;"><span>    .eraseToAnyPublisher()
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>Just like explained in <a href="https://trycombine.com/posts/subscribe-on-receive-on/">subscribe(on:) vs receive(on:)</a> I&rsquo;m using <code>receive(on:)</code> to switch the downstream scheduler to the main queue.</p>
<p>And that&rsquo;s pretty much it - the completed property wrapper code is:</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span>@propertyWrapper
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">public</span> <span style="color:#6ab825;font-weight:bold">class</span> <span style="color:#447fcf;text-decoration:underline">PublishedOnMain</span>&lt;Value&gt; {
</span></span><span style="display:flex;"><span>  @Published <span style="color:#6ab825;font-weight:bold">var</span> <span style="color:#40ffff">value</span>: Value
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#6ab825;font-weight:bold">public</span> <span style="color:#6ab825;font-weight:bold">var</span> <span style="color:#40ffff">wrappedValue</span>: Value {
</span></span><span style="display:flex;"><span>    <span style="color:#6ab825;font-weight:bold">get</span> { value }
</span></span><span style="display:flex;"><span>    <span style="color:#6ab825;font-weight:bold">set</span> { value = newValue }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#6ab825;font-weight:bold">public</span> <span style="color:#6ab825;font-weight:bold">var</span> <span style="color:#40ffff">projectedValue</span>: AnyPublisher&lt;Value, Never&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#6ab825;font-weight:bold">return</span> <span style="color:#a61717;background-color:#e3d2d2">$</span>value
</span></span><span style="display:flex;"><span>      .receive(on: DispatchQueue.main)
</span></span><span style="display:flex;"><span>      .eraseToAnyPublisher()
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#6ab825;font-weight:bold">public</span> <span style="color:#6ab825;font-weight:bold">init</span>(wrappedValue initialValue: Value) {
</span></span><span style="display:flex;"><span>    value = initialValue
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>Now I can use <code>@PublishedOnMain</code> on any property to add a &ldquo;mirror&rdquo; property which is a publisher on the main queue other types can subscribe. This effectively removes the need for consumers to always ensure receiving on the main queue for each subscription. 🤯</p>
<p>Now I can improve my <code>CourseViewModel</code> from earlier like so:</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">struct</span> <span style="color:#447fcf;text-decoration:underline">CourseViewModel</span> {
</span></span><span style="display:flex;"><span>  @PublishedOnMain <span style="color:#6ab825;font-weight:bold">var</span> <span style="color:#40ffff">name</span>: <span style="color:#24909d">String</span>
</span></span><span style="display:flex;"><span>  @PublishedOnMain <span style="color:#6ab825;font-weight:bold">var</span> <span style="color:#40ffff">surname</span>: <span style="color:#24909d">String</span>
</span></span><span style="display:flex;"><span>  @PublishedOnMain <span style="color:#6ab825;font-weight:bold">var</span> <span style="color:#40ffff">progress</span>: <span style="color:#24909d">Int</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>And safely bind the publishers to my UI controls:</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span>viewModel.<span style="color:#a61717;background-color:#e3d2d2">$</span>name
</span></span><span style="display:flex;"><span>  .assign(to: <span style="color:#a61717;background-color:#e3d2d2">\</span>.text, on: nameLabel)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>viewModel.<span style="color:#a61717;background-color:#e3d2d2">$</span>surname
</span></span><span style="display:flex;"><span>  .assign(to: <span style="color:#a61717;background-color:#e3d2d2">\</span>.text, on: surnameLabel)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>viewModel.<span style="color:#a61717;background-color:#e3d2d2">$</span>progress
</span></span><span style="display:flex;"><span>  .map { <span style="color:#ed9d13">&#34;Course progress: </span><span style="color:#ed9d13">\(</span><span style="color:#40ffff">$0</span><span style="color:#ed9d13">)</span><span style="color:#ed9d13">%&#34;</span> }
</span></span><span style="display:flex;"><span>  .assign(to: <span style="color:#a61717;background-color:#e3d2d2">\</span>.text, on: progressLabel)</span></span></code></pre></div>
<p>Isn&rsquo;t that just awesome?</p>
<h2 id="further-combine-property-wrappers">Further Combine Property Wrappers</h2>
<p>What else could be a useful abstraction via property wrappers? The sky is the limit as long as the code is clear at the point of usage and the property wrapper names are semantic.</p>
<p>Let&rsquo;s look at one final example - let&rsquo;s make a property wrapper ensuring a property emits a maxium of one value:</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span>@propertyWrapper
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">public</span> <span style="color:#6ab825;font-weight:bold">class</span> <span style="color:#447fcf;text-decoration:underline">Single</span>&lt;Value&gt; {
</span></span><span style="display:flex;"><span>  @Published <span style="color:#6ab825;font-weight:bold">var</span> <span style="color:#40ffff">value</span>: Value
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#6ab825;font-weight:bold">public</span> <span style="color:#6ab825;font-weight:bold">var</span> <span style="color:#40ffff">wrappedValue</span>: Value {
</span></span><span style="display:flex;"><span>    <span style="color:#6ab825;font-weight:bold">get</span> { value }
</span></span><span style="display:flex;"><span>    <span style="color:#6ab825;font-weight:bold">set</span> { value = newValue }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#6ab825;font-weight:bold">public</span> <span style="color:#6ab825;font-weight:bold">var</span> <span style="color:#40ffff">projectedValue</span>: AnyPublisher&lt;Value, Never&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#6ab825;font-weight:bold">return</span> <span style="color:#a61717;background-color:#e3d2d2">$</span>value
</span></span><span style="display:flex;"><span>      .<span style="color:#6ab825;font-weight:bold">prefix</span>(<span style="color:#3677a9">1</span>)
</span></span><span style="display:flex;"><span>      .eraseToAnyPublisher()
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#6ab825;font-weight:bold">public</span> <span style="color:#6ab825;font-weight:bold">init</span>(wrappedValue initialValue: Value) {
</span></span><span style="display:flex;"><span>    value = initialValue
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>The code is largely the same as before - the only difference being that the <code>propejectedValue</code> publisher will emit either zero or one elements thanks to the <code>prefix(1)</code> operator.</p>
<p>That&rsquo;s all for today - wasn&rsquo;t that fun? 😁</p>
<h2 id="where-to-go-from-here">Where to go from here?</h2>
<p>To learn about all the Combine operators which you can use to create your own property wrappers have a look at <a href="http://combinebook.com">Combine: Asynchronous programming with Swift</a> - this is where you can see all updates, discuss in the website forums, and more.</p>
</div>
    <hr/>
    <div><i>If you like these free blog posts, check out some of the books I worked on!</i></div>

    <div id="combinebook">
      <table width="100%">
        <tr>
          <td style="font-size: 0.9em; font-family: sans-serif; font-weight: bold; text-align:center;">
            <a href="http://swiftconcurrencybook.com" target="_blank" style="text-decoration:none;">
              <img src="https://trycombine.com/images/concurrency-book.png" style="width:150px; box-shadow: 4px 6px #354465;border-radius:5px;">
            </a>
            <br/>
            <a href="http://swiftconcurrencybook.com">Modern Concurrency in Swift</a><span class="new-badge">New</span>
          </td>
          
          <td style="font-size: 0.9em; font-family: sans-serif; font-weight: bold; text-align:center;">
            <a href="http://combinebook.com" target="_blank" style="text-decoration:none;">
              <img src="https://trycombine.com/images/combine.png" style="width:150px; box-shadow: 4px 6px #354465;border-radius:10px;">
            </a>
            <br/>
            <a href="https://combinebook.com">Combine: Asynchronous<br/> programming with Swift</a>
          </td>
        </tr>
      </table>
				<br/>
		</div>
		<p class="meta">Posted on <span class="postdate">11. September 2019</span></p>
	</article>
	

			</div>

			<footer id="footer">
				<p class="copyright">
					
						Powered by <a href="https://gohugo.io/">Hugo</a> and the
						<a href="https://github.com/bake/solar-theme-hugo">Solar</a>-theme.
					
				</p>
			</footer>
		</div>

		<script src="https://www.w3counter.com/tracker.js?id=147849"></script>
<script>
  if (window.location.href.indexOf("localhost") < 0) {
    
  } else {
    console.log('localhost');
  }
</script>
	</body>
</html>
